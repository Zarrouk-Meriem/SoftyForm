import { readFile } from 'node:fs/promises';
import { matchIconName } from '@iconify/utils/lib/icon/name';
import { createBaseCollectionsListImporter } from './base.js';
/**
 * Create importer for `collections.json`
 */
export function createJSONCollectionsListImporter(downloader, createIconSetImporter, options) {
    const obj = createBaseCollectionsListImporter(downloader, createIconSetImporter);
    // Load data
    obj._loadCollectionsListFromDirectory = async (path) => {
        let prefixes;
        let data;
        const filename = options?.filename || '/collections.json';
        try {
            data = JSON.parse(await readFile(path + filename, 'utf8'));
            prefixes = Object.keys(data).filter((prefix) => matchIconName.test(prefix));
            if (!(prefixes instanceof Array)) {
                console.error(`Error loading "${filename}": invalid data`);
                return;
            }
        }
        catch (err) {
            console.error(err);
            return;
        }
        // Filter keys
        const filter = options?.filter;
        if (filter) {
            prefixes = prefixes.filter((prefix) => filter(prefix, data[prefix]));
        }
        return prefixes;
    };
    return obj;
}
